# Automation Hello World Test Procedure

This document provides a step-by-step procedure for testing the V2 automation functionality of the custom-agents-orchestrator MCP server using a simple "Hello World" test.

## Prerequisites

Before running this test, ensure you have:

1. Configured the MCP server with `AUTOMATION_MODE=V2` and a valid `ANTHROPIC_API_KEY` as described in [v2_automation_setup.md](./v2_automation_setup.md)
2. Restarted RooCode to load the updated configuration
3. Verified that the MCP server is running with V2 mode enabled

## Test Task Using execute_agent_mode

The following test uses the `execute_agent_mode` tool to run a simple task that verifies the automation is working correctly.

### Test Code

```typescript
use_mcp_tool('custom-agents-orchestrator', 'execute_agent_mode', {
  "mode_slug": "orchestrator-goal-clarification",
  "task_description": "This is a simple test to verify V2 automation is working correctly. Please respond with 'AUTOMATION WORKING OK' followed by the current timestamp."
})
```

### Expected Response Format

A successful response should look like this:

```json
{
  "success": true,
  "modeSlug": "orchestrator-goal-clarification",
  "response": "To: uber-orchestrator, From: orchestrator-goal-clarification\n\nAUTOMATION WORKING OK - [timestamp]\n\nV2 automation has been successfully configured and is functioning as expected. The Claude API integration is working properly, and the agent mode was executed autonomously.",
  "sessionId": "sess_abc123...",
  "tokensUsed": {
    "input": 245,
    "output": 78
  }
}
```

### Key Elements to Verify

1. `"success": true` - Indicates the execution completed successfully
2. `"modeSlug": "orchestrator-goal-clarification"` - Confirms the correct mode was executed
3. `"response"` contains:
   - Proper routing headers (`To: uber-orchestrator, From: orchestrator-goal-clarification`)
   - The "AUTOMATION WORKING OK" message
   - A timestamp showing when the execution occurred
4. `"sessionId"` - A unique session ID generated by the Claude API
5. `"tokensUsed"` - Token usage statistics for the execution

## How to Interpret Results

### Success Case

If you receive a response similar to the expected format above, the V2 automation is working correctly. This confirms:

- The MCP server is properly configured with `AUTOMATION_MODE=V2`
- The `ANTHROPIC_API_KEY` is valid and working
- The Claude Agent SDK integration is functioning
- The agent mode execution pipeline is operational

### Failure Cases and Troubleshooting

#### 1. "V2 automation is not enabled" Error

```json
{
  "mode": "V1_SIMULATION",
  "message": "V2 automation is not enabled. Set AUTOMATION_MODE=V2 environment variable to enable automated execution.",
  "help": "Current mode only supports delegation simulation. Use delegate_to_mode for V1 functionality."
}
```

**Solution**: Verify that `AUTOMATION_MODE` is set to `"V2"` in mcp_settings.json and restart RooCode.

#### 2. API Key Error

```json
{
  "success": false,
  "modeSlug": "orchestrator-goal-clarification",
  "error": "ANTHROPIC_API_KEY environment variable is required when AUTOMATION_MODE=V2.",
  "fallback": "V1 simulation mode available via delegate_to_mode tool"
}
```

**Solution**: Ensure the `ANTHROPIC_API_KEY` is correctly set in mcp_settings.json and is a valid key.

#### 3. Agent Executor Not Initialized

```json
{
  "success": false,
  "modeSlug": "orchestrator-goal-clarification",
  "error": "Agent Executor not initialized. Check ANTHROPIC_API_KEY is set.",
  "fallback": "V1 simulation mode available via delegate_to_mode tool"
}
```

**Solution**: This indicates a problem with the initialization of the Agent Executor. Check the RooCode console for more detailed error messages.

#### 4. API Rate Limit or Network Error

```json
{
  "success": false,
  "modeSlug": "orchestrator-goal-clarification",
  "error": "Error calling Anthropic API: Rate limit exceeded",
  "fallback": "V1 simulation mode available via delegate_to_mode tool"
}
```

**Solution**: Wait a few minutes and try again. If the problem persists, check your network connection and API key quota.

#### 5. Mode Not Found

```json
{
  "success": false,
  "modeSlug": "orchestrator-goal-clarification",
  "error": "Mode not found: orchestrator-goal-clarification",
  "fallback": "V1 simulation mode available via delegate_to_mode tool"
}
```

**Solution**: Verify that the `AGENTS_DIR` environment variable is correctly set and that the specified mode exists in the agents directory.

## Advanced Testing

Once the basic "Hello World" test is working, you can try more complex tests:

### 1. Test with Different Modes

Try executing different agent modes to ensure they all work correctly:

```typescript
use_mcp_tool('custom-agents-orchestrator', 'execute_agent_mode', {
  "mode_slug": "research-planner-strategic",
  "task_description": "Create a simple one-paragraph research plan for testing V2 automation."
})
```

### 2. Test with Context Files

Test providing context files to the agent:

```typescript
use_mcp_tool('custom-agents-orchestrator', 'execute_agent_mode', {
  "mode_slug": "orchestrator-goal-clarification",
  "task_description": "Summarize the content of the provided file.",
  "context_files": ["docs/project_plan.md"]
})
```

### 3. Test with Parent Session ID

Test conversation threading with a parent session ID:

```typescript
// First execution
const result = await use_mcp_tool('custom-agents-orchestrator', 'execute_agent_mode', {
  "mode_slug": "orchestrator-goal-clarification",
  "task_description": "Start a conversation about V2 automation."
});

// Second execution with parent session ID
use_mcp_tool('custom-agents-orchestrator', 'execute_agent_mode', {
  "mode_slug": "orchestrator-goal-clarification",
  "task_description": "Continue the conversation about V2 automation.",
  "parent_session_id": result.sessionId
})
```

## Performance Considerations

The V2 automation uses the Claude 3 Haiku model by default, which offers the best balance of cost and performance:

- Input tokens: $0.25 per 1M tokens
- Output tokens: $1.25 per 1M tokens
- Average cost per execution: ~$0.08
- Typical response time: 2-5 seconds

For more complex tasks, you may want to consider using a more powerful model by setting the `DEFAULT_MODEL` environment variable in mcp_settings.json:

```json
"env": {
  "AUTOMATION_MODE": "V2",
  "ANTHROPIC_API_KEY": "sk-ant-your-api-key",
  "DEFAULT_MODEL": "claude-3-sonnet-20240229"
}
```

## Conclusion

This Hello World test provides a simple way to verify that the V2 automation is working correctly. Once this test passes, you can be confident that the MCP server is properly configured and ready to execute agent modes autonomously.

Remember that each execution consumes API tokens and may incur costs, so use the V2 automation judiciously, especially when running tests.